---
######### OpenSSH client (ssh_config) configuration rendering

- name: Copy custom global ssh_config configuration in place
  template:
    src: "{{ client_config_file }}.j2"
    dest: "{{ global_config_dir }}/{{ client_config_file }}"
    owner: root
    group: root
    mode: 0644
    backup: true
  vars:
    account: global
  become: true
  when: ssh_config.client is defined and "global" in ssh_config.client

- name: Copy user ssh_config configuration in place
  template:
    src: "{{ client_config_file }}.j2"
    dest: "/home/{{ item }}/.ssh/config"
    owner: "{{ item }}"
    group: "{{ item }}"
    mode: 0644
  vars:
    account: "{{ item }}"
  with_items: "{{ ssh_config.client.keys() | difference(['global']) }}"
  become: true
  when: ssh_config.client is defined
